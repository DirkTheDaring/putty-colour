#!powershell
# https://docs.microsoft.com/en-us/powershell/scripting/samples/working-with-registry-entries?view=powershell-7
# https://docs.microsoft.com/en-us/powershell/scripting/samples/working-with-registry-keys?view=powershell-7
# 0 arguments -> list sessions + colour scheme
# 1 arguments --> list availble colour schemes
# 2 argument --> set session + colour scheme

$COLOUR_LIST_COUNT=22
$template_list=@(
("Apple-Terminal","230,230,230","255,255,255","0,0,0","0,0,0","187,187,187","255,255,255","0,0,0","100,102,102","187,0,0","255,85,85","0,187,0","100,210,56","187,187,0","255,255,85","0,0,187","52,66,241","187,0,187","255,85,255","0,187,187","85,255,255","224,224,224","255,255,255"),
("Argonaut","255,250,244","158,156,154","14,16,25","14,16,25","255,0,24","255,0,24","35,35,35","68,68,68","255,0,15","255,39,64","140,225,11","171,225,91","255,185,0","255,210,66","0,141,248","0,146,255","109,67,166","154,95,235","0,216,235","103,255,240","255,255,255","255,255,255"),
("Birds-Of-Paradise","224,219,183","255,248,216","42,31,29","42,31,29","87,61,38","87,61,38","87,61,38","155,108,74","190,45,38","232,70,39","107,161,138","149,216,186","233,157,42","208,209,80","90,134,173","184,211,237","172,128,166","209,158,203","116,166,173","147,207,215","224,219,183","255,249,213"),
("Blazer","217,230,242","217,230,242","13,25,38","13,25,38","217,230,242","217,230,242","0,0,0","38,38,38","184,122,122","219,189,189","122,184,122","189,219,189","184,184,122","219,219,189","122,122,184","189,189,219","184,122,184","219,189,219","122,184,184","189,219,219","217,217,217","255,255,255"),
("Chalkboard","217,230,242","217,111,95","41,38,47","41,38,47","217,230,242","217,230,242","0,0,0","50,50,50","195,115,114","219,170,170","114,195,115","170,219,170","194,195,114","218,219,170","115,114,195","170,170,219","195,114,194","219,170,218","114,194,195","170,218,219","217,217,217","255,255,255"),
("Ciapre","174,164,122","244,244,244","25,28,39","25,28,39","146,128,91","174,164,122","24,24,24","85,85,85","129,0,9","172,56,53","72,81,59","166,167,93","204,139,63","220,223,124","87,109,140","48,151,198","114,77,124","211,48,97","92,79,75","243,219,178","174,164,127","244,244,244"),
("Dark-Pastel","255,255,255","255,94,125","0,0,0","0,0,0","187,187,187","255,255,255","0,0,0","85,85,85","255,85,85","255,85,85","85,255,85","85,255,85","255,255,85","255,255,85","85,85,255","85,85,255","255,85,255","255,85,255","85,255,255","85,255,255","187,187,187","255,255,255"),
("Desert","255,255,255","255,215,0","51,51,51","51,51,51","0,255,0","255,255,255","77,77,77","85,85,85","255,43,43","255,85,85","152,251,152","85,255,85","240,230,140","255,255,85","205,133,63","135,206,255","255,222,173","255,85,255","255,160,160","255,215,0","245,222,179","255,255,255"),
("Espresso","255,255,255","255,255,255","50,50,50","50,50,50","214,214,214","255,255,255","53,53,53","83,83,83","210,82,82","240,12,12","165,194,97","194,224,117","255,198,109","225,228,139","108,153,187","138,183,217","209,151,217","239,181,247","190,214,255","220,244,255","238,238,236","255,255,255"),
("Fish-Of-Paradise","224,219,183","255,248,216","35,35,44","35,35,44","87,61,38","87,61,38","87,61,38","155,108,74","190,45,38","232,70,39","107,161,138","149,216,186","233,157,42","208,209,80","90,134,173","184,211,237","172,128,166","209,158,203","116,166,173","147,207,215","224,219,183","255,249,213"),
("Fish-Tank","236,240,254","246,255,235","35,37,55","35,37,55","254,205,94","236,240,254","3,7,60","108,91,48","198,0,74","218,75,138","172,241,87","219,255,169","254,205,94","254,230,169","82,95,184","178,190,250","152,111,130","253,165,205","150,135,99","165,189,134","236,240,252","246,255,236"),
("github","62,62,62","201,85,0","244,244,244","244,244,244","63,63,63","62,62,62","62,62,62","102,102,102","151,11,22","222,0,0","7,150,42","135,213,162","248,238,199","241,208,7","0,62,138","46,108,186","233,70,145","255,162,159","137,209,236","28,250,254","255,255,255","255,255,255"),
("Grass","255,240,165","255,176,59","19,119,61","19,119,61","140,40,0","255,255,255","0,0,0","85,85,85","187,0,0","187,0,0","0,187,0","0,187,0","231,176,0","231,176,0","0,0,163","0,0,187","149,0,98","255,85,255","0,187,187","85,255,255","187,187,187","255,255,255"),
("Highway","237,237,237","255,248,216","34,34,37","34,34,37","224,217,185","237,237,237","0,0,0","93,80,74","208,14,24","240,126,24","19,128,52","177,209,48","255,203,62","255,241,32","0,107,179","79,194,253","107,39,117","222,0,113","56,69,100","93,80,74","237,237,237","255,255,255"),
("Homebrew","0,255,0","0,255,0","0,0,0","0,0,0","35,255,24","255,0,24","0,0,0","102,102,102","153,0,0","229,0,0","0,166,0","0,217,0","153,153,0","229,229,0","0,0,178","0,0,255","178,0,178","229,0,229","0,166,178","0,229,229","191,191,191","229,229,229"),
("Hurtado","219,219,219","255,255,255","0,0,0","0,0,0","187,187,187","255,255,255","87,87,87","38,38,38","255,27,0","213,29,0","165,224,85","165,223,85","251,231,74","251,232,74","73,100,135","137,190,255","253,95,241","192,1,193","134,233,254","134,234,254","203,204,203","219,219,219"),
("Ic-Green-Ppl","217,239,211","159,255,109","58,61,63","58,61,63","66,255,88","217,239,211","31,31,31","3,39,16","251,0,42","167,255,63","51,156,36","159,255,109","101,155,37","210,255,109","20,155,69","114,255,181","83,184,44","80,255,62","44,184,104","34,255,113","224,255,239","218,239,208"),
("Idletoes","255,255,255","255,255,169","50,50,50","50,50,50","214,214,214","255,255,255","50,50,50","83,83,83","210,82,82","240,112,112","127,225,115","157,255,145","255,198,109","255,228,139","64,153,255","94,183,247","246,128,255","255,157,255","190,214,255","220,244,255","238,238,236","255,255,255"),
("Igvita-Desert","255,255,255","255,255,255","51,51,51","85,85,85","0,0,0","0,255,0","77,77,77","85,85,85","255,43,43","255,85,85","152,251,152","85,255,85","240,230,140","255,255,85","205,133,63","135,206,235","255,222,173","255,85,255","255,160,160","255,215,0","245,222,179","255,255,255"),
("Igvita-Light","187,187,187","255,255,255","0,0,0","85,85,85","0,0,0","0,255,0","0,0,0","85,85,85","187,0,0","255,85,85","152,251,152","85,255,85","187,187,0","255,255,85","3,92,190","85,85,255","187,0,187","255,85,255","255,160,160","85,255,255","187,187,187","255,255,255"),
("Invisibone","160,160,160","207,207,207","35,35,35","35,35,35","160,160,160","160,160,160","48,48,48","104,104,104","211,112,163","255,167,218","109,158,63","163,213,114","181,136,88","239,189,139","96,149,197","152,203,254","172,123,222","229,176,255","59,162,117","117,218,169","207,207,207","255,255,255"),
("Kibble","247,247,247","202,99,30","14,16,10","14,16,10","159,218,156","247,247,247","77,77,77","90,90,90","199,0,49","240,21,120","41,207,19","108,224,92","216,227,14","243,247,158","52,73,209","151,164,247","132,0,255","196,149,240","7,152,171","104,242,224","226,209,227","255,255,255"),
("Liquid-Carbon","175,194,194","255,255,255","48,48,48","48,48,48","255,255,255","175,194,194","0,0,0","0,0,0","255,48,48","255,48,48","85,154,112","85,154,112","204,172,0","204,172,0","0,153,204","0,153,204","204,105,200","204,105,200","122,196,204","122,196,204","188,204,204","188,204,204"),
("Liquid-Carbon-Transparent","175,194,194","255,255,255","0,0,0","0,0,0","255,255,255","175,194,194","0,0,0","0,0,0","255,48,48","255,48,48","85,154,112","85,154,112","204,172,0","204,172,0","0,153,204","0,153,204","204,105,200","204,105,200","122,196,204","122,196,204","188,204,204","188,204,204"),
("Liquid-Carbon-Transparent-Inverse","175,194,194","255,255,255","0,0,0","0,0,0","255,255,255","175,194,194","188,204,205","255,255,255","255,48,48","255,48,48","85,154,112","85,154,112","204,172,0","204,172,0","0,153,204","0,153,204","204,105,200","204,105,200","122,196,204","122,196,204","0,0,0","0,0,0"),
("Man-Page","0,0,0","0,0,0","254,244,156","254,244,156","127,127,127","0,0,0","0,0,0","102,102,102","204,0,0","229,0,0","0,166,0","0,217,0","153,153,0","229,229,0","0,0,178","0,0,255","178,0,178","229,0,229","0,166,178","0,229,229","204,204,204","229,229,229"),
("Monokai-Soda","196,197,181","196,197,181","26,26,26","26,26,26","246,247,236","196,197,181","26,26,26","98,94,76","244,0,95","244,0,95","152,224,36","152,224,36","250,132,25","224,213,97","157,101,255","157,101,255","244,0,95","244,0,95","88,209,235","88,209,235","196,197,181","246,246,239"),
("Monokai-Dimmed","185,188,186","254,255,178","31,31,31","31,31,31","248,62,25","185,188,186","58,61,67","136,137,135","190,63,72","251,0,31","135,154,59","15,114,47","197,166,53","196,112,51","79,118,161","24,109,227","133,92,141","251,0,103","87,143,164","46,112,109","185,188,186","253,255,185"),
("Monokai-Stevelosh","219,219,219","255,255,255","0,0,0","0,0,0","187,187,187","255,255,255","0,0,0","85,85,85","229,34,34","255,85,85","166,227,45","85,255,85","252,149,30","255,255,85","196,141,255","85,85,255","250,37,115","255,85,255","103,217,240","85,255,255","242,242,242","255,255,255"),
("Neopolitan","255,255,255","255,255,255","23,19,16","23,19,16","255,255,255","255,255,255","23,19,16","23,19,16","128,0,0","128,0,0","97,206,60","97,206,60","251,222,45","251,222,45","37,59,118","37,59,118","255,0,128","255,0,128","141,166,206","141,166,206","248,248,248","248,248,248"),
("Novel","59,35,34","142,42,25","223,219,195","223,219,195","115,99,90","0,0,0","0,0,0","128,128,128","204,0,0","204,0,0","0,150,0","0,150,0","208,107,0","208,107,0","0,0,204","0,0,204","204,0,204","204,0,204","0,135,204","0,135,204","204,204,204","255,255,255"),
("Ocean","255,255,255","255,255,255","34,79,188","34,79,188","127,127,127","255,255,255","0,0,0","102,102,102","153,0,0","229,0,0","0,166,0","0,217,0","153,153,0","229,229,0","0,0,178","0,0,255","178,0,178","229,0,229","0,166,178","0,229,229","191,191,191","229,229,229"),
("Papirus-Dark","209,195,184","209,195,184","46,44,40","46,44,40","209,195,184","209,195,184","113,115,112","46,44,40","140,115,90","153,138,122","174,196,149","180,204,153","191,187,153","230,227,202","136,161,186","136,161,186","109,104,113","148,141,153","92,83,70","122,135,53","200,185,114","228,221,150"),
("Pro","242,242,242","255,255,255","0,0,0","0,0,0","77,77,77","255,255,255","0,0,0","102,102,102","153,0,0","229,0,0","0,166,0","0,217,0","153,153,0","229,229,0","32,9,219","0,0,255","178,0,178","229,0,229","0,166,178","0,229,229","191,191,191","229,229,229"),
("Red-Sands","215,201,167","223,189,34","122,37,30","122,37,30","255,255,255","0,0,0","0,0,0","85,85,85","255,63,0","187,0,0","0,187,0","0,187,0","231,176,0","231,176,0","0,114,255","0,114,174","187,0,187","255,85,255","0,187,187","85,255,255","187,187,187","255,255,255"),
("Seafoam-Pastel","212,231,212","100,136,144","36,52,53","36,52,53","87,100,122","212,231,212","117,117,117","138,138,138","130,93,77","207,147,122","114,140,98","152,217,170","173,161,109","250,231,157","77,123,130","122,195,207","138,114,103","214,178,161","114,148,148","173,224,224","224,224,224","224,224,224"),
("Solarized-Dark","131,148,150","147,161,161","0,43,54","7,54,66","0,43,54","238,232,213","7,54,66","0,43,54","220,50,47","203,75,22","133,153,0","88,110,117","181,137,0","101,123,131","38,139,210","131,148,150","211,54,130","108,113,196","42,161,152","147,161,161","238,232,213","253,246,227"),
("Solarized-Light","101,123,131","88,110,117","253,246,227","238,232,213","238,232,213","101,123,131","7,54,66","0,43,54","220,50,47","203,75,22","133,153,0","88,110,117","181,137,0","101,123,131","38,139,210","131,148,150","211,54,130","108,113,196","42,161,152","147,161,161","238,232,213","253,246,227"),
("Solarized-Darcula","210,216,217","236,236,236","61,63,65","61,63,65","112,130,132","0,40,49","37,41,42","37,41,42","242,72,64","242,72,64","98,150,85","98,150,85","182,136,0","182,136,0","32,117,199","32,117,199","121,127,212","121,127,212","21,150,141","21,150,141","210,216,217","210,216,217"),
("Sundried","201,201,201","255,255,255","26,24,24","26,24,24","255,255,255","201,201,201","48,43,42","77,78,72","167,70,61","170,0,12","88,119,68","18,140,33","157,96,42","252,106,33","72,91,152","121,153,247","134,70,81","253,138,161","156,129,79","250,212,132","201,201,201","255,255,255"),
("Sympfonic","255,255,255","255,132,0","0,0,0","0,0,0","220,50,47","255,255,255","0,0,0","27,29,33","220,50,47","220,50,47","86,219,58","86,219,58","255,132,0","255,132,0","0,132,212","0,132,212","183,41,217","183,41,217","204,204,255","204,204,255","255,255,255","255,255,255"),
("Teerb","208,208,208","229,229,229","38,38,38","38,38,38","228,201,175","208,208,208","28,28,28","28,28,28","214,134,134","214,134,134","174,214,134","174,214,134","215,175,135","228,201,175","134,174,214","134,174,214","214,174,214","214,174,214","138,219,180","177,231,221","208,208,208","239,239,239"),
("Terminal-Basic","0,0,0","0,0,0","255,255,255","255,255,255","127,127,127","0,0,0","0,0,0","102,102,102","153,0,0","229,0,0","0,166,0","0,217,0","153,153,0","229,229,0","0,0,178","0,0,255","178,0,178","229,0,229","0,166,178","0,229,229","191,191,191","229,229,229"),
("Thayer","160,160,160","255,255,255","27,29,30","27,29,30","0,0,0","252,151,31","27,29,30","80,83,84","249,38,114","255,89,149","130,180,20","182,227,84","253,151,31","254,237,108","86,194,214","140,237,255","140,84,254","158,111,254","64,128,128","85,170,170","204,204,198","248,248,242"),
("Tomorrow","77,77,76","234,234,234","250,250,250","0,0,0","214,214,214","77,77,76","142,144,140","0,0,0","255,51,52","200,40,41","158,196,0","113,140,0","234,183,0","245,135,31","87,149,230","66,113,174","183,119,224","137,89,168","84,206,214","62,153,159","239,239,239","214,214,214"),
("Tomorrow-Night","197,200,198","234,234,234","29,31,33","0,0,0","197,200,198","197,200,198","29,31,33","0,0,0","204,102,102","213,78,83","181,189,104","185,202,74","240,198,116","231,197,71","129,162,190","122,166,218","178,148,187","195,151,216","138,190,183","112,192,177","192,200,198","234,234,234"),
("Twilight","255,255,212","255,255,212","20,20,20","20,20,20","255,255,255","255,255,212","20,20,20","38,38,38","192,109,68","222,124,76","175,185,122","204,216,140","194,168,108","226,196,126","68,71,74","90,94,98","180,190,124","208,220,142","119,131,133","138,152,155","255,255,212","255,255,212"),
("Vaughn","220,220,204","255,94,125","37,35,79","37,35,79","255,85,85","255,255,255","37,35,79","112,144,128","112,80,80","220,163,163","96,180,138","96,180,138","223,175,143","240,223,175","85,85,255","85,85,255","240,140,195","236,147,211","140,208,211","147,224,227","112,144,128","255,255,255"),
("X-Dotshare","215,208,199","255,255,255","21,21,21","21,21,21","255,137,57","215,208,199","16,16,16","64,64,64","232,79,79","210,61,61","184,214,140","160,207,93","225,170,93","243,157,33","125,193,207","78,159,177","155,100,251","133,66,255","109,135,141","66,113,123","221,221,221","221,221,221"),
("Zenburn","220,220,204","220,220,204","63,63,63","63,63,63","115,99,90","0,0,0","77,77,77","112,144,128","112,80,80","220,163,163","96,180,138","195,191,159","240,223,175","224,207,159","80,96,112","148,191,243","220,140,195","236,147,211","140,208,211","147,224,227","220,220,204","255,255,255"),
("Mariana","216,222,233","147,161,161","52,61,70","79,91,102","0,43,54","216,222,233","79,91,102","0,43,56","236,95,103","203,75,22","153,199,148","88,110,117","249,174,88","101,123,131","102,153,204","216,222,233","197,148,197","108,113,196","95,179,179","147,161,161","216,222,233","253,246,227"),
("baldur", "217,230,242","217,230,242","14,27,48","14,27,48","14,27,48","217,230,242","0,0,0","46,46,46","215,49,64","223,100,112","80,194,54","128,202,105","215,184,54","223,194,105","58,91,199","97,127,204","206,49,199","216,100,207","71,194,189","122,202,200","211,211,211","255,255,255"),
("vserver", "238,232,213","101,123,131","0,43,54","85,85,85","0,0,0","0,255,0","0,0,0","85,85,85","220,50,47","255,85,85","133,153,0","85,255,85","181,137,0","255,255,85","38,139,210","85,85,255","211,54,130","255,85,255","42,161,152","85,255,255","187,187,187","255,255,255"),
("fedora", "211,218,227","255,255,255","64,69,82","85,85,85","0,0,0","0,255,0","0,0,0","85,85,85","223,44,44","255,85,85","0,187,0","85,255,85","187,187,0","255,255,85","52,226,226","85,85,255","187,0,187","255,85,255","0,187,187","85,255,255","187,187,187","255,255,255"),
("unkown", "255,255,255","255,255,255","51,51,51","85,85,85","0,0,0","0,255,0","77,77,77","85,85,85","187,0,0","255,85,85","152,251,152","85,255,85","240,230,140","255,255,85","150,133,63","135,206,235","255,222,173","255,85,255","255,160,160","255,215,0","245,222,179","255,255,255")

)


function get_session_list
{
  #param( $registry_key ) 
  $registry_path="Registry::HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions"
  $list = Get-ChildItem -Path $registry_path |Select-Object Name
  $array = @()
  Foreach ($item in $list) {
    $array += $item.Name
  }
  return $array
}

function dump_colour_list
{
  param( $entry )
  For ($i=0; $i -lt $COLOUR_LIST_COUNT; $i++) {
    $entry."Colour$i"
  }
}

function dump_colour_list3
{
  param( $entry )
  For ($i=0; $i -lt $COLOUR_LIST_COUNT; $i++) {
    """Colour$i""=""" + $entry."Colour$i" + """"
  }
}

function colour_list_to_array
{
  param( $entry )

  $array = @()
  For ($i=0; $i -lt $COLOUR_LIST_COUNT; $i++) {
    $array += $entry."Colour$i"
  }
  return $array
}

function dump_colour_list_names
{
  param( $list )

  foreach ($name in $list) {
    $a = $name -split("\\")
    $a[5]
  }
}

function convert_to_powershell
{
  param( $array )
  $result = $array -join(""",""") 
  return """" + $result + """"
}

$colour_lookup_table=@()
$name_lookup_table=@()
foreach( $template in $template_list)
{
  #$template[0]
  $array = $template[1..$COLOUR_LIST_COUNT]
  $ident = $array -join(""",""")
  $ident = """$ident"""

  $colour_lookup_table += $ident
  $name_lookup_table   += $template[0]
}

$list = get_session_list
#dump_colour_list_names($list)

if ( $args.count -eq 0 ) {
  foreach ($name in $list) {
    $entry = Get-ItemProperty -Path Registry::$name 
    #"[$name]"
    #dump_colour_list3($entry)
    $array = colour_list_to_array($entry)
    $result = convert_to_powershell($array)
  
    $i = 0 
    $result2 = "***"
    foreach( $item in $colour_lookup_table ) {
      if ( $result -eq $item ) {
         $result2 = $name_lookup_table[$i]
         break
      }
      $i = $i + 1
    }
    $a =  $name -split("\\")
    $name = $a[5]
    "$name : $result2"
    # "$name : $result"
  }
  exit 
}
if ( $args.count -eq  1 ) {
  foreach( $name in $name_lookup_table ) {
    "$name"
  } 
}
if ( $args.count -eq 2 ) {
  $session = $args[0]
  $colour  = $args[1]

  $i=0
  $session_pos=-1
  foreach ( $name in $list ) {
    $a =  $name -split("\\")
    $name = $a[5]

    if ( $session -eq $name ) {
      $session_pos = $i
      break
    }
    $i = $i + 1
  }
  if ( $session_pos -eq -1 ) {
    "session '$session' not found"
    exit 1
  }

  $i=0
  $colour_pos=-1
  foreach ( $name in $name_lookup_table) {
    if ( $colour -eq $name ) {
      $colour_pos = $i
      break
    }
    $i = $i + 1
  }
  if ( $colour_pos -eq -1 ) {
    "colour '$colour' not found"
    exit 1
  }
  "Setting $session to $colour"

  $template=$template_list[$colour_pos]
  $array=$template[1..$COLOUR_LIST_COUNT]
  
  For ($i=0; $i -lt $COLOUR_LIST_COUNT; $i++) {
    $registry_path="Registry::HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\$session"
    $value = $array[$i]
    "$registry_path\Colour$i=$value"
    Set-ItemProperty -Path $registry_path -Name "Colour$i" -Value "$value"
  }
}
